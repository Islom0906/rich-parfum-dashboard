"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[97],{75097:(e,i,t)=>{t.r(i),t.d(i,{default:()=>j});var a=t(72791),s=t(2409),l=t(50419),r=t(66106),n=t(30914),o=t(49389),u=t(93086),d=t(87309),c=t(91933),m=t(27169),p=t(14138),g=t(57689),f=t(16030),v=t(77221),h=t(68117),Z=t(80184);const _={image_uz:"",image_ru:"",title_ru:"",title_uz:""},j=()=>{const[e]=s.Z.useForm(),i=(0,g.s0)(),{editId:t}=(0,f.v9)((e=>e.editData)),j=(0,f.I0)(),[x,b]=(0,a.useState)([]),[F,w]=(0,a.useState)([]),{mutate:S,data:y,isLoading:z,isSuccess:I}=(0,c.useMutation)((e=>{let{url:i,data:t}=e;return m.Z.postData(i,t)}),{onSuccess:()=>{l.ZP.success("Success")},onError:e=>{for(let i in e.response.data)l.ZP.error("".concat(i,": ").concat(e.response.data[i][0]))}}),{isLoading:C,data:L,refetch:E,isSuccess:V}=(0,c.useQuery)(["edit-special",t],(()=>m.Z.getDataByID("products/special",t)),{enabled:!1}),{mutate:P,isLoading:D,data:O,isSuccess:U}=(0,c.useMutation)((e=>{let{url:i,data:t,id:a}=e;return m.Z.editData(i,t,a)}),{onSuccess:()=>{l.ZP.success("Success")},onError:e=>{for(let i in e.response.data)l.ZP.error("".concat(i,": ").concat(e.response.data[i][0]))}});(0,a.useEffect)((()=>{U&&j({type:v.Pb,payload:""}),(I||U)&&i("/special")}),[y,O]),(0,a.useEffect)((()=>{""!==t&&E()}),[t]),(0,a.useEffect)((()=>{""===t&&e.setFieldsValue(_)}),[]),(0,a.useEffect)((()=>{if(V){const i=[{uid:null===L||void 0===L?void 0:L.id,name:null===L||void 0===L?void 0:L.id,status:"done",url:null===L||void 0===L?void 0:L.image_uz}],t=[{uid:null===L||void 0===L?void 0:L.id,name:null===L||void 0===L?void 0:L.id,status:"done",url:null===L||void 0===L?void 0:L.image_ru}],a={title_uz:L.title_uz,title_ru:L.title_ru,image_uz:L.image_uz,image_ru:L.image_ru};b(i),w(t),e.setFieldsValue(a)}}),[L]);(0,a.useEffect)((()=>{const i=JSON.parse(localStorage.getItem("myFormValues"));i&&(i.images=[],e.setFieldsValue(i));const t=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",t),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",t)}}),[]);const k=async e=>{let i=e.url;i||(i=await new Promise((i=>{const t=new FileReader;t.readAsDataURL(e.originFileObj),t.onload=()=>i(t.result)})));const t=new Image;t.src=i;const a=window.open(i);null===a||void 0===a||a.document.write(t.outerHTML)};return(0,Z.jsx)("div",{children:z||C||D?(0,Z.jsx)(p.QP,{}):(0,Z.jsxs)(s.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:_,onFinish:e=>{var i,a;const s=new FormData;var l,r;(s.append("title_uz",e.title_uz),s.append("title_ru",e.title_ru),null!==(i=x[0])&&void 0!==i&&i.originFileObj)&&s.append("image_uz",null===(l=x[0])||void 0===l?void 0:l.originFileObj);null!==(a=F[0])&&void 0!==a&&a.originFileObj&&s.append("image_ru",null===(r=F[0])||void 0===r?void 0:r.originFileObj);L?P({url:"/products/special",data:s,id:t}):S({url:"/products/special/",data:s})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,Z.jsxs)(r.Z,{gutter:20,children:[(0,Z.jsx)(n.Z,{span:12,children:(0,Z.jsx)(s.Z.Item,{label:"Specialning nomini kiriting",name:"title_uz",rules:[{required:!0,message:"Nomi talab qilinadi"}],wrapperCol:{span:24},children:(0,Z.jsx)(o.default,{})})}),(0,Z.jsx)(n.Z,{span:12,children:(0,Z.jsx)(s.Z.Item,{label:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u043f\u0435\u0446.",name:"title_ru",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u043f\u0435\u0446"}],wrapperCol:{span:24},children:(0,Z.jsx)(o.default,{})})})]}),(0,Z.jsxs)(r.Z,{gutter:20,children:[(0,Z.jsx)(n.Z,{span:12,children:(0,Z.jsx)(s.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 Ru",name:"image_ru",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f Ru"}],children:(0,Z.jsx)(h.Z,{rotationSlider:!0,children:(0,Z.jsx)(u.Z,{maxCount:1,fileList:x,listType:"picture-card",onChange:i=>{let{fileList:t}=i;b(t),e.setFieldsValue({image_uz:t})},onPreview:k,beforeUpload:()=>!1,children:x.length>0?"":"Upload"})})})}),(0,Z.jsx)(n.Z,{span:12,children:(0,Z.jsx)(s.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 Uz",name:"image_uz",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f Uz"}],children:(0,Z.jsx)(h.Z,{rotationSlider:!0,children:(0,Z.jsx)(u.Z,{maxCount:1,fileList:F,listType:"picture-card",onChange:i=>{let{fileList:t}=i;w(t),e.setFieldsValue({image_ru:t})},onPreview:k,beforeUpload:()=>!1,children:F.length>0?"":"Upload"})})})})]}),(0,Z.jsx)(d.Z,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:V?"Edit":"Add"})]})})}},30914:(e,i,t)=>{t.d(i,{Z:()=>a});const a=t(89752).Z}}]);
//# sourceMappingURL=97.781c3f8f.chunk.js.map