"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[97],{68438:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(74165),a=n(15861),i=n(74569),u=n.n(i);u().defaults.baseURL="".concat("http://95.46.96.105/backend/api"),u().interceptors.request.use((function(e){var t=function(e){try{return localStorage.getItem(e)}catch(t){console.log("Error getting data")}}("richtoken"),n=null!==t?"Bearer ".concat(t):"";return e.headers.authorization=n,e}));var o=u(),s={getData:function(e){return(0,a.Z)((0,r.Z)().mark((function t(){var n,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.get(e);case 2:return n=t.sent,a=n.data,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))()},getDataByID:function(e,t){return(0,a.Z)((0,r.Z)().mark((function n(){var a,i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.get("".concat(e,"/").concat(t));case 2:return a=n.sent,i=a.data,n.abrupt("return",i);case 5:case"end":return n.stop()}}),n)})))()},postData:function(e,t){return(0,a.Z)((0,r.Z)().mark((function n(){var a,i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.post(e,t);case 2:return a=n.sent,i=a.data,n.abrupt("return",i);case 5:case"end":return n.stop()}}),n)})))()},editData:function(e,t,n){return(0,a.Z)((0,r.Z)().mark((function a(){var i,u;return(0,r.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,o.put("".concat(e,"/").concat(n,"/"),t);case 2:return i=r.sent,u=i.data,r.abrupt("return",u);case 5:case"end":return r.stop()}}),a)})))()},deleteData:function(e,t){return(0,a.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.delete("".concat(e,"/").concat(t));case 2:case"end":return n.stop()}}),n)})))()},deleteImages:function(e,t){return(0,a.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(),n.next=3,o.delete(e,{data:t});case 3:case"end":return n.stop()}}),n)})))()}}},75097:function(e,t,n){n.r(t);var r=n(74165),a=n(15861),i=n(29439),u=n(72791),o=n(2409),s=n(50419),c=n(66106),l=n(30914),d=n(49389),f=n(93086),p=n(87309),m=n(91933),v=n(68438),g=n(14138),Z=n(57689),h=n(16030),x=n(77221),w=n(22645),b=n(80184),_={image_uz:"",image_ru:"",title_ru:"",title_uz:""};t.default=function(){var e=o.Z.useForm(),t=(0,i.Z)(e,1)[0],n=(0,Z.s0)(),j=(0,h.v9)((function(e){return e.editData})).editId,F=(0,h.I0)(),S=(0,u.useState)([]),y=(0,i.Z)(S,2),z=y[0],I=y[1],k=(0,u.useState)([]),D=(0,i.Z)(k,2),L=D[0],C=D[1],E=(0,m.useMutation)((function(e){var t=e.url,n=e.data;return v.Z.postData(t,n)}),{onSuccess:function(){s.ZP.success("Success")},onError:function(e){for(var t in e.response.data)s.ZP.error("".concat(t,": ").concat(e.response.data[t][0]))}}),V=E.mutate,P=E.data,U=E.isLoading,O=E.isSuccess,q=(0,m.useQuery)(["edit-special",j],(function(){return v.Z.getDataByID("products/special",j)}),{enabled:!1}),R=q.isLoading,T=q.data,B=q.refetch,M=q.isSuccess,N=(0,m.useMutation)((function(e){var t=e.url,n=e.data,r=e.id;return v.Z.editData(t,n,r)}),{onSuccess:function(){s.ZP.success("Success")},onError:function(e){for(var t in e.response.data)s.ZP.error("".concat(t,": ").concat(e.response.data[t][0]))}}),A=N.mutate,J=N.isLoading,Q=N.data,H=N.isSuccess;(0,u.useEffect)((function(){H&&F({type:x.Pb,payload:""}),(O||H)&&n("/special")}),[P,Q]),(0,u.useEffect)((function(){""!==j&&B()}),[j]),(0,u.useEffect)((function(){""===j&&t.setFieldsValue(_)}),[]),(0,u.useEffect)((function(){if(M){var e=[{uid:null===T||void 0===T?void 0:T.id,name:null===T||void 0===T?void 0:T.id,status:"done",url:null===T||void 0===T?void 0:T.image_uz}],n=[{uid:null===T||void 0===T?void 0:T.id,name:null===T||void 0===T?void 0:T.id,status:"done",url:null===T||void 0===T?void 0:T.image_ru}],r={title_uz:T.title_uz,title_ru:T.title_ru,image_uz:T.image_uz,image_ru:T.image_ru};I(e),C(n),t.setFieldsValue(r)}}),[T]);(0,u.useEffect)((function(){var e=JSON.parse(localStorage.getItem("myFormValues"));e&&(e.images=[],t.setFieldsValue(e));var n=function(){localStorage.setItem("myFormValues",JSON.stringify(t.getFieldsValue()))};return window.addEventListener("beforeunload",n),function(){localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",n)}}),[]);var W=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.url){e.next=5;break}return e.next=4,new Promise((function(e){var n=new FileReader;n.readAsDataURL(t.originFileObj),n.onload=function(){return e(n.result)}}));case 4:n=e.sent;case 5:(a=new Image).src=n,null===(i=window.open(n))||void 0===i||i.document.write(a.outerHTML);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,b.jsx)("div",{children:U||R||J?(0,b.jsx)(g.QP,{}):(0,b.jsxs)(o.Z,{form:t,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:_,onFinish:function(e){var t,n,r,a,i=new FormData;(i.append("title_uz",e.title_uz),i.append("title_ru",e.title_ru),null!==(t=z[0])&&void 0!==t&&t.originFileObj)&&i.append("image_uz",null===(r=z[0])||void 0===r?void 0:r.originFileObj);null!==(n=L[0])&&void 0!==n&&n.originFileObj&&i.append("image_ru",null===(a=L[0])||void 0===a?void 0:a.originFileObj);T?A({url:"/products/special",data:i,id:j}):V({url:"/products/special/",data:i})},onFinishFailed:function(e){console.log("Failed:",e)},autoComplete:"off",children:[(0,b.jsxs)(c.Z,{gutter:20,children:[(0,b.jsx)(l.Z,{span:12,children:(0,b.jsx)(o.Z.Item,{label:"Specialning nomini kiriting",name:"title_uz",rules:[{required:!0,message:"Nomi talab qilinadi"}],wrapperCol:{span:24},children:(0,b.jsx)(d.Z,{})})}),(0,b.jsx)(l.Z,{span:12,children:(0,b.jsx)(o.Z.Item,{label:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u043f\u0435\u0446.",name:"title_ru",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u043f\u0435\u0446"}],wrapperCol:{span:24},children:(0,b.jsx)(d.Z,{})})})]}),(0,b.jsxs)(c.Z,{gutter:20,children:[(0,b.jsx)(l.Z,{span:12,children:(0,b.jsx)(o.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 Ru",name:"image_ru",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f Ru"}],children:(0,b.jsx)(w.Z,{rotationSlider:!0,children:(0,b.jsx)(f.Z,{maxCount:1,fileList:z,listType:"picture-card",onChange:function(e){var n=e.fileList;I(n),t.setFieldsValue({image_uz:n})},onPreview:W,beforeUpload:function(){return!1},children:z.length>0?"":"Upload"})})})}),(0,b.jsx)(l.Z,{span:12,children:(0,b.jsx)(o.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 Uz",name:"image_uz",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f Uz"}],children:(0,b.jsx)(w.Z,{rotationSlider:!0,children:(0,b.jsx)(f.Z,{maxCount:1,fileList:L,listType:"picture-card",onChange:function(e){var n=e.fileList;C(n),t.setFieldsValue({image_ru:n})},onPreview:W,beforeUpload:function(){return!1},children:L.length>0?"":"Upload"})})})})]}),(0,b.jsx)(p.Z,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:M?"Edit":"Add"})]})})}},30914:function(e,t,n){var r=n(89752);t.Z=r.Z}}]);
//# sourceMappingURL=97.86971b3a.chunk.js.map