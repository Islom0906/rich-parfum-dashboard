"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[767],{43016:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var i=a(72791),n=a(521),l=a(2409),s=a(50419),r=a(66106),o=a(30914),u=a(93086),d=a(49389),c=a(87309),m=a(91933),g=a(27169),v=a(14138),h=a(57689),f=a(16030),p=a(68117),x=a(68747),Z=a(66920),b=a(77221),_=a(80184);const{Title:j}=n.default,y={image:[],text_uz:"",text_ru:"",about_children:[{name_uz:"",name_ru:"",image:[]}]},w=()=>{const[e]=l.Z.useForm(),t=(0,h.s0)(),{editId:a}=(0,f.v9)((e=>e.editData)),n=(0,f.I0)(),[w,F]=(0,i.useState)([]),[S,z]=(0,i.useState)([]),[E,I]=(0,i.useState)(""),[L,C]=(0,i.useState)(0),{mutate:D,data:P,isLoading:V,isSuccess:M}=(0,m.useMutation)((e=>{let{url:t,formData:a}=e;return g.Z.postData(t,a)}),{onSuccess:()=>{s.ZP.success("Success")},onError:e=>{for(let t in e.response.data)s.ZP.error("".concat(t,": ").concat(e.response.data[t][0]))}}),{mutate:k,data:q,isLoading:A,isSuccess:O}=(0,m.useMutation)((e=>{let{url:t,data:a}=e;return g.Z.postData(t,a)}),{onSuccess:()=>{s.ZP.success("Success")},onError:e=>{for(let t in e.response.data)s.ZP.error("".concat(t,": ").concat(e.response.data[t][0]))}}),{isLoading:T,data:U,refetch:B,isSuccess:N}=(0,m.useQuery)(["edit-about",a],(()=>g.Z.getDataByID("/about/about",a)),{enabled:!1}),{mutate:R,isLoading:H,data:J,isSuccess:K}=(0,m.useMutation)((e=>{let{url:t,data:a,id:i}=e;return g.Z.editData(t,a,i)}),{onSuccess:()=>{s.ZP.success("Success")},onError:e=>{for(let t in e.response.data)s.ZP.error("".concat(t,": ").concat(e.response.data[t][0]))}}),{mutate:Q}=(0,m.useMutation)((e=>{let{url:t,ids:a}=e;return g.Z.deleteImages(t,a)}),{onSuccess:()=>s.ZP.success("Success"),onError:e=>s.ZP.error(e.message)});(0,i.useEffect)((()=>{K&&n({type:b.Pb,payload:""}),(O||K)&&t("/about")}),[q,J]),(0,i.useEffect)((()=>{""!==a&&B()}),[a]),(0,i.useEffect)((()=>{""===a&&e.setFieldsValue(y)}),[]),(0,i.useEffect)((()=>{var t,a,i;const n=[],l=[];if(void 0!==U)for(let e=0;e<U.about_children.length;e++){var s,r,o,u,d,c;let t=[{uid:null===(s=U.about_children[e])||void 0===s||null===(r=s.image)||void 0===r?void 0:r.id,name:null===(o=U.about_children[e])||void 0===o||null===(u=o.image)||void 0===u?void 0:u.id,status:"done",url:null===(d=U.about_children[e])||void 0===d||null===(c=d.image)||void 0===c?void 0:c.image}];const a={name_uz:U.about_children[e].name_uz,name_ru:U.about_children[e].name_ru,image:t};n.push(a),l.push(t)}const m=[{uid:null===U||void 0===U||null===(t=U.image)||void 0===t?void 0:t.id,name:null===U||void 0===U||null===(a=U.image)||void 0===a?void 0:a.id,status:"done",url:null===U||void 0===U||null===(i=U.image)||void 0===i?void 0:i.image}];if(N){const t={image:m,text_uz:U.text_uz,text_ru:U.text_ru,about_children:n};F(m),z(l),e.setFieldsValue(t)}}),[U]);(0,i.useEffect)((()=>{const t=JSON.parse(localStorage.getItem("myFormValues"));t&&(t.images=[],e.setFieldsValue(t));const a=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",a),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",a)}}),[]),(0,i.useEffect)((()=>{if(M&&"main"===E){var t,a,i;const e=[{uid:null===P||void 0===P||null===(t=P.images[0])||void 0===t?void 0:t.id,name:null===P||void 0===P||null===(a=P.images[0])||void 0===a?void 0:a.id,status:"done",url:null===P||void 0===P||null===(i=P.images[0])||void 0===i?void 0:i.url}];F(e),I("")}const n=[...S];if(M&&"child"===E){var l,s,r;const t=[{uid:null===P||void 0===P||null===(l=P.images[0])||void 0===l?void 0:l.id,name:null===P||void 0===P||null===(s=P.images[0])||void 0===s?void 0:s.id,status:"done",url:null===P||void 0===P||null===(r=P.images[0])||void 0===r?void 0:r.url}];n[L]=t,z(n);const a=e.getFieldsValue(),i=null===a||void 0===a?void 0:a.about_children;i[L]||(i[L]={name_uz:"",name_ru:"",image:[]}),i[L].image=t,e.setFieldsValue({items:i}),I("")}}),[P]);const G=async e=>{let t=e.url;t||(t=await new Promise((t=>{const a=new FileReader;a.readAsDataURL(e.originFileObj),a.onload=()=>t(a.result)})));const a=new Image;a.src=t;const i=window.open(t);null===i||void 0===i||i.document.write(a.outerHTML)};return(0,_.jsx)("div",{children:A||T||H||V?(0,_.jsx)(v.QP,{}):(0,_.jsxs)(l.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:y,onFinish:e=>{var t;const i=[];for(let a=0;a<e.about_children.length;a++){let t="";var n,l;if(S.length>0)if(null===S[a]||(null===(n=S[a])||void 0===n?void 0:n.length)<1)t="";else t=null===(l=S[a][0])||void 0===l?void 0:l.uid;const s={name_uz:e.about_children[a].name_uz,name_ru:e.about_children[a].name_ru,image:[t]};i.push(s)}const s={text_uz:e.text_uz,text_ru:e.text_ru,image:[null===(t=w[0])||void 0===t?void 0:t.uid],about_children:i};N?R({url:"/about/about",data:s,id:a}):k({url:"/about/about/",data:s})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,_.jsxs)(r.Z,{gutter:20,children:[(0,_.jsx)(o.Z,{span:12,children:(0,_.jsx)(l.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0412\u0430\u0440\u0438\u0430\u043d\u0442",name:"text_ru",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0412\u0430\u0440\u0438\u0430\u043d\u0442"}],children:(0,_.jsx)(Z.Z,{rows:4})})}),(0,_.jsx)(o.Z,{span:12,children:(0,_.jsx)(l.Z.Item,{label:"Kompaniya haqida matn",name:"text_uz",rules:[{required:!0,message:"Matn talab qilinadi"}],children:(0,_.jsx)(Z.Z,{rows:4})})})]}),(0,_.jsx)(r.Z,{gutter:20,children:(0,_.jsx)(o.Z,{span:12,children:(0,_.jsx)(l.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439",name:"image",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439"}],children:(0,_.jsx)(p.Z,{children:(0,_.jsx)(u.Z,{maxCount:1,fileList:w,listType:"picture-card",onChange:t=>{let{fileList:a}=t;if(e.setFieldsValue({image:a}),0!==w.length||0===a.length){var i;const e=[null===(i=w[0])||void 0===i?void 0:i.uid];Q({url:"/delete-images",ids:{image_ids:e}}),F([])}const n=new FormData;0!==a.length&&(n.append("uploaded_images",a[0].originFileObj),D({url:"/products/product-image/",formData:n}),I("main"))},onPreview:G,beforeUpload:()=>!1,children:w.length>0?"":"Upload"})})})})}),(0,_.jsx)(j,{level:3,children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430"}),(0,_.jsx)(l.Z.List,{name:"about_children",children:(t,a)=>{let{add:i,remove:n}=a;return(0,_.jsxs)(_.Fragment,{children:[t.map(((e,t)=>{const a=S[t]||[];return(0,_.jsxs)("div",{style:{marginBottom:20},children:[(0,_.jsxs)(r.Z,{gutter:20,children:[(0,_.jsx)(o.Z,{span:12,children:(0,_.jsx)(l.Z.Item,{label:"Afzalliklar nomi",name:[e.name,"name_uz"],rules:[{required:!0,message:"Afzalliklar nomi talab qilinadi"}],children:(0,_.jsx)(d.default,{})})}),(0,_.jsx)(o.Z,{span:12,children:(0,_.jsx)(l.Z.Item,{label:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u041f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430",name:[e.name,"name_ru"],rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u041f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430"}],children:(0,_.jsx)(d.default,{})})})]}),(0,_.jsx)(l.Z.Item,{label:"\u041f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430 \u0424\u043e\u0442\u043e ".concat(t+1),name:[e.name,"image"],rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u041f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430"}],children:(0,_.jsx)(p.Z,{rotate:!0,children:(0,_.jsx)(u.Z,{maxCount:1,listType:"picture-card",fileList:a,onChange:e=>((e,t)=>{let{fileList:a}=t;if(C(e),S[e]||0===a.length){const t=[S[e][0].uid];Q({url:"/delete-images",ids:{image_ids:t}}),S[e]=null,z(S)}const i=new FormData;0!==a.length&&(i.append("uploaded_images",a[0].originFileObj),D({url:"/products/product-image/",formData:i}),I("child"))})(t,e),onPreview:G,beforeUpload:()=>!1,children:a.length<1&&"+ Upload"})})}),(0,_.jsx)(x.Z,{onClick:()=>((e,t,a,i)=>{if(i===S[a]&&S.length>0){var n;const e=[null===(n=S[a][0])||void 0===n?void 0:n.uid];S.splice(a,1),Q({url:"/delete-images",ids:{image_ids:e}})}t(e)})(e.name,n,t,a)})]},e.fieldKey)})),(0,_.jsx)(l.Z.Item,{children:(0,_.jsx)(c.Z,{type:"primary",onClick:()=>(t=>{let a=[];t();const i=e.getFieldsValue();null!==i&&void 0!==i&&i.about_children[0]||a.push({name_uz:"",name_ru:"",image:[]}),e.setFieldsValue({items:a})})(i),block:!0,style:{backgroundColor:"#28a745"},children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u043f\u0440\u0435\u0434\u043c\u0435\u0442"})})]})}}),(0,_.jsx)(c.Z,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:N?"Edit":"Add"})]})})}},31752:(e,t,a)=>{a.d(t,{Z:()=>o});var i=a(1413),n=a(72791);const l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};var s=a(54291),r=function(e,t){return n.createElement(s.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:l}))};r.displayName="EditOutlined";const o=n.forwardRef(r)},68747:(e,t,a)=>{a.d(t,{Z:()=>o});var i=a(1413),n=a(72791);const l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};var s=a(54291),r=function(e,t){return n.createElement(s.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:l}))};r.displayName="MinusCircleOutlined";const o=n.forwardRef(r)},30914:(e,t,a)=>{a.d(t,{Z:()=>i});const i=a(89752).Z},42748:(e,t,a)=>{a.d(t,{G:()=>s});var i=a(14937),n=function(e){if((0,i.Z)()&&window.document.documentElement){var t=Array.isArray(e)?e:[e],a=window.document.documentElement;return t.some((function(e){return e in a.style}))}return!1},l=function(e,t){if(!n(e))return!1;var a=document.createElement("div"),i=a.style[e];return a.style[e]=t,a.style[e]!==i};function s(e,t){return Array.isArray(e)||void 0===t?n(e):l(e,t)}}}]);
//# sourceMappingURL=767.10ea3c27.chunk.js.map